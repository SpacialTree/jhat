
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "examples/plot_a_hst.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_examples_plot_a_hst.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_examples_plot_a_hst.py:


======
Hubble
======

Aligning HST images with JHAT.

.. GENERATED FROM PYTHON SOURCE LINES 10-12

An example HST Dataset is downloaded, and then a series of
alignment methods are used.

.. GENERATED FROM PYTHON SOURCE LINES 12-31

.. code-block:: default

   

    import sys,os,glob
    from astropy.io import fits
    from astropy.table import Table
    from astropy.nddata import extract_array
    from astropy.coordinates import SkyCoord
    from astropy import wcs
    from astropy.wcs.utils import skycoord_to_pixel
    from astropy import units as u
    import numpy as np
    import matplotlib.pyplot as plt
    from astroquery.mast import Observations
    from astropy.visualization import (simple_norm,LinearStretch)

    import jhat
    from jhat import hst_photclass,st_wcs_align









.. GENERATED FROM PYTHON SOURCE LINES 32-37

**Download some Data**

For this example we download 2 HST FLT images from MAST. They're
the same filter and same field, just separated in time. Note that 
the code will also work for drizzled images.

.. GENERATED FROM PYTHON SOURCE LINES 37-54

.. code-block:: default


    obs_table = Observations.query_criteria(obs_id='hst_16264_12_wfc3_ir_f110w_iebc12')
    obs_table1 = obs_table[obs_table['filters']=='F110W']

    obs_table = Observations.query_criteria(obs_id='hst_16264_15_wfc3_ir_f110w_iebc15')
    obs_table2 = obs_table[obs_table['filters']=='F110W']

    data_products_by_obs = Observations.get_product_list(obs_table1)
    data_products_by_obs = data_products_by_obs[data_products_by_obs['calib_level']==3]
    data_products_by_obs = data_products_by_obs[data_products_by_obs['productSubGroupDescription']=='DRZ'][0]
    Observations.download_products(data_products_by_obs,extension='fits')

    data_products_by_obs = Observations.get_product_list(obs_table2)
    data_products_by_obs = data_products_by_obs[data_products_by_obs['calib_level']==3]
    data_products_by_obs = data_products_by_obs[data_products_by_obs['productSubGroupDescription']=='DRZ'][0]
    Observations.download_products(data_products_by_obs,extension='fits')





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    INFO: Found cached file ./mastDownload/HST/hst_16264_12_wfc3_ir_f110w_iebc12/hst_16264_12_wfc3_ir_f110w_iebc12_drz.fits with expected size 25672320. [astroquery.query]
    INFO: Found cached file ./mastDownload/HST/hst_16264_15_wfc3_ir_f110w_iebc15/hst_16264_15_wfc3_ir_f110w_iebc15_drz.fits with expected size 24454080. [astroquery.query]


.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><i>Table length=1</i>
    <table id="table140155962891184" class="table-striped table-bordered table-condensed">
    <thead><tr><th>Local Path</th><th>Status</th><th>Message</th><th>URL</th></tr></thead>
    <thead><tr><th>str95</th><th>str8</th><th>object</th><th>object</th></tr></thead>
    <tr><td>./mastDownload/HST/hst_16264_15_wfc3_ir_f110w_iebc15/hst_16264_15_wfc3_ir_f110w_iebc15_drz.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
    </table></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 55-57

**Examine the Reference Image**


.. GENERATED FROM PYTHON SOURCE LINES 57-69

.. code-block:: default


    files = glob.glob('mastDownload/HST/*/*drz.fits')
    ref_image = files[0]
    ref_fits = fits.open(ref_image)
    ref_data = fits.open(ref_image)['SCI',1].data
    norm1 = simple_norm(ref_data,stretch='log',min_cut=-1,max_cut=15)

    plt.imshow(ref_data, origin='lower',
                          #interval=MinMaxInterval(),
                          norm=norm1,cmap='gray')
    plt.show()




.. image-sg:: /examples/images/sphx_glr_plot_a_hst_001.png
   :alt: plot a hst
   :srcset: /examples/images/sphx_glr_plot_a_hst_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 70-76

**Zoom in to see the offset**

Here add an artificial offset to the wcs, and then we see the 
same star in both images at the same ra/dec
location, demonstrating a large offset between
the images.  

.. GENERATED FROM PYTHON SOURCE LINES 76-104

.. code-block:: default


    star_location = SkyCoord('21:29:40.5351','+0:04:42.697',unit=(u.hourangle,u.deg))
    align_image = files[1]
    align_fits = fits.open(align_image)
    align_fits['SCI',1].header['CRPIX1']+=2
    align_fits['SCI',1].header['CRPIX2']+=2
    align_fits.writeto(align_image,overwrite=True)

    align_data = fits.open(align_image)['SCI',1].data
    ref_y,ref_x = skycoord_to_pixel(star_location,wcs.WCS(ref_fits['SCI',1],ref_fits))
    align_y,align_x = skycoord_to_pixel(star_location,wcs.WCS(align_fits['SCI',1],align_fits))

    ref_cutout = extract_array(ref_data,(11,11),(ref_x,ref_y))
    align_cutout = extract_array(align_data,(11,11),(align_x,align_y))
    norm1 = simple_norm(ref_cutout,stretch='log',min_cut=-1,max_cut=200)
    norm2 = simple_norm(align_cutout,stretch='log',min_cut=-1,max_cut=200)
    fig,axes = plt.subplots(1,2)
    axes[0].imshow(ref_cutout, origin='lower',
                          norm=norm1,cmap='gray')
    axes[1].imshow(align_cutout, origin='lower',
                          norm=norm2,cmap='gray')
    axes[0].set_title('Reference')
    axes[1].set_title('To Align')
    axes[0].tick_params(labelcolor='none',axis='both',color='none')
    axes[1].tick_params(labelcolor='none',axis='both',color='none')

    plt.show()




.. image-sg:: /examples/images/sphx_glr_plot_a_hst_002.png
   :alt: Reference, To Align
   :srcset: /examples/images/sphx_glr_plot_a_hst_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 105-109

**Create a Photometric Catalog for Relative Alignment**

We choose one of the images to be the reference image, and then 
create a catalog that we will use to align the other image.

.. GENERATED FROM PYTHON SOURCE LINES 109-116

.. code-block:: default


    hst_phot = hst_photclass(psf_fwhm=1.8,aperture_radius=5)
    hst_phot.run_phot(imagename=ref_image,photfilename='auto',overwrite=True)
    ref_catname = ref_image.replace('.fits','.phot.txt') # the default
    refcat = Table.read(ref_catname,format='ascii')
    print(refcat)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    ### Doing photometry on mastDownload/HST/hst_16264_15_wfc3_ir_f110w_iebc15/hst_16264_15_wfc3_ir_f110w_iebc15_drz.fits
    photometry catalog filename: mastDownload/HST/hst_16264_15_wfc3_ir_f110w_iebc15/hst_16264_15_wfc3_ir_f110w_iebc15_drz.phot.txt
    photcat mastDownload/HST/hst_16264_15_wfc3_ir_f110w_iebc15/hst_16264_15_wfc3_ir_f110w_iebc15_drz.phot.txt already exists, but recreating it since overwrite=True
    Finding stars --- Detector: None, Filter: F110W
    FWHM for the filter F110W: 1.8 px
    /Users/jpierel/miniconda3/envs/jhat/lib/python3.8/site-packages/astropy/stats/sigma_clipping.py:411: AstropyUserWarning: Input data contains invalid values (NaNs or infs), which were automatically clipped.
      warnings.warn('Input data contains invalid values (NaNs or '
    /Users/jpierel/miniconda3/envs/jhat/lib/python3.8/site-packages/astropy/stats/sigma_clipping.py:411: AstropyUserWarning: Input data contains invalid values (NaNs or infs), which were automatically clipped.
      warnings.warn('Input data contains invalid values (NaNs or '

    Number of sources found in the image: 1131
    -------------------------------------

    F110W
    Performing aperture photometry for radius r = 5 px
    /Users/jpierel/CodeBase/jhat/jhat/simple_jwst_phot.py:1787: RuntimeWarning: invalid value encountered in log10
      phot['mag'] = -2.5*np.log10(phot['aper_sum_bkgsub'])+ee_corr+zp
    /Users/jpierel/CodeBase/jhat/jhat/simple_jwst_phot.py:1790: RuntimeWarning: invalid value encountered in log10
      phot['magerr'] = 2.5 * np.log10(1.0 + (fluxerr/phot['aper_sum_bkgsub']))
    Time Elapsed: 1.0154953840000003
    996 objects left after removing entries with NaNs in mag or dmag column
    SNR_min cut: 769 objects left after removing entries dmag>0.36200000000000004 (SNR<3.0)
    769 out of 996 entries remain in photometry table
    0      564.920608
    1      597.019189
    2      598.103872
    3      582.375299
    4      584.963518
              ...    
    991    727.293150
    992    774.224117
    993    768.362622
    994    822.566556
    995    783.355309
    Name: x, Length: 996, dtype: float64
    Saving mastDownload/HST/hst_16264_15_wfc3_ir_f110w_iebc15/hst_16264_15_wfc3_ir_f110w_iebc15_drz.phot.txt
    aper_sum_5.0px annulus_median_5.0px aper_bkg_5.0px ...   x_idl     y_idl   
    -------------- -------------------- -------------- ... --------- ----------
         98.701667             1.222411       96.00792 ...   10.2829 -58.751291
        112.858706             1.215698       95.48066 ...  0.099716 -56.988333
        101.386792             1.221536      95.939216 ... 11.171638 -55.244084
        103.395263             1.223189      96.069016 ... 12.050499 -54.702786
         98.175293             1.216523      95.545525 ...   18.3728 -52.885932
        105.185496             1.218957      95.736631 ... 20.125268 -52.409859
         98.467547             1.222876      96.044429 ...  8.878883 -51.562419
        101.177947             1.223379      96.083963 ...  9.447841 -51.376254
        100.858702             1.222229      95.993609 ...  9.589213  -51.28844
         97.385972             1.211675       95.16475 ... -1.323612 -51.067408
               ...                  ...            ... ...       ...        ...
        106.700343             1.228208      96.463241 ... 38.894967  98.502383
        100.028488             1.227914      96.440138 ... 38.374138   99.52547
         97.812187             1.220744       95.87702 ... 26.977885  99.641609
         97.602171             1.223988      96.131806 ... 37.761717  100.23342
        105.374356             1.219726      95.797025 ... 33.155941 100.494186
           97.8211             1.222627       96.02488 ... 36.519167 101.346027
        102.603917             1.224512      96.172937 ... 22.996226 101.696774
         97.176473             1.223463      96.090578 ... 29.490227 101.683134
        106.491542             1.221884      95.966541 ... 28.696313 105.056795
        136.421425             1.214221      95.364713 ... 36.206767 105.813416
        105.466896             1.229285      96.547856 ...  30.77963 106.393258
    Length = 769 rows




.. GENERATED FROM PYTHON SOURCE LINES 117-122

**Align the second image**

The plots outputted here show the various steps used by jhat to
determine the true matching sources in the image, and the
subsequent correction needed for optimal alignment.

.. GENERATED FROM PYTHON SOURCE LINES 122-145

.. code-block:: default


    wcs_align = st_wcs_align()
    wcs_align.outdir = 'mastDownload'


    wcs_align.run_all(align_image,
    		  telescope='hst',
              refcat_racol='ra',
              refcat_deccol='dec',
              refcat_magcol='mag',
              refcat_magerrcol='dmag',
              overwrite=True,
              d2d_max=.5,
              showplots=2,
              refcatname=ref_catname,
              histocut_order='dxdy',
                  sharpness_lim=(0.3,0.9),
                  roundness1_lim=(-0.7, 0.7),
                  SNR_min= 3,
                  dmag_max=1.0,
                  objmag_lim =(14,24))





.. rst-class:: sphx-glr-horizontal


    *

      .. image-sg:: /examples/images/sphx_glr_plot_a_hst_003.png
         :alt: Initial cut: d2d_max=0.5, dmag_max=1.0, Nbright=None, delta_mag_lim=(None, None)
         :srcset: /examples/images/sphx_glr_plot_a_hst_003.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /examples/images/sphx_glr_plot_a_hst_004.png
         :alt: dx, dx, dx, slope:0.0020019531249999755, 3-sigma cut: 12 out of 15 left mean = 0.121 px, stdev = 0.097 px
         :srcset: /examples/images/sphx_glr_plot_a_hst_004.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /examples/images/sphx_glr_plot_a_hst_005.png
         :alt: dy, dy, dy, slope:-0.0047363281250000005, 3-sigma cut: 7 out of 7 left mean = 2.098 px, stdev = 0.361 px
         :srcset: /examples/images/sphx_glr_plot_a_hst_005.png
         :class: sphx-glr-multi-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Warning: Setting aperture radius to twice the psf_fwhm (4.000000)

    ### Doing photometry on mastDownload/HST/hst_16264_12_wfc3_ir_f110w_iebc12/hst_16264_12_wfc3_ir_f110w_iebc12_drz.fits
    NO photometry catalog filename
    Finding stars --- Detector: None, Filter: F110W
    FWHM for the filter F110W: 2 px
    /Users/jpierel/miniconda3/envs/jhat/lib/python3.8/site-packages/astropy/stats/sigma_clipping.py:411: AstropyUserWarning: Input data contains invalid values (NaNs or infs), which were automatically clipped.
      warnings.warn('Input data contains invalid values (NaNs or '
    /Users/jpierel/miniconda3/envs/jhat/lib/python3.8/site-packages/astropy/stats/sigma_clipping.py:411: AstropyUserWarning: Input data contains invalid values (NaNs or infs), which were automatically clipped.
      warnings.warn('Input data contains invalid values (NaNs or '

    Number of sources found in the image: 1065
    -------------------------------------

    F110W
    Performing aperture photometry for radius r = 4 px
    /Users/jpierel/CodeBase/jhat/jhat/simple_jwst_phot.py:1787: RuntimeWarning: invalid value encountered in log10
      phot['mag'] = -2.5*np.log10(phot['aper_sum_bkgsub'])+ee_corr+zp
    /Users/jpierel/CodeBase/jhat/jhat/simple_jwst_phot.py:1790: RuntimeWarning: invalid value encountered in log10
      phot['magerr'] = 2.5 * np.log10(1.0 + (fluxerr/phot['aper_sum_bkgsub']))
    Time Elapsed: 0.8347681349999991
    947 objects left after removing entries with NaNs in mag or dmag column
    SNR_min cut: 733 objects left after removing entries dmag>0.36200000000000004 (SNR<3)
    733 out of 947 entries remain in photometry table
    0      760.533300
    1      723.807600
    2      754.520511
    3      757.049685
    4      781.571165
              ...    
    942    749.749942
    943    703.933299
    944    697.050660
    945    647.708427
    946    696.459286
    Name: x, Length: 947, dtype: float64
    /Users/jpierel/miniconda3/envs/jhat/lib/python3.8/site-packages/stdatamodels/validate.py:38: ValidationWarning: While validating meta.instrument.name the following error occurred:
    'WFC3' is not one of ['NIRCAM', 'NIRSPEC', 'MIRI', 'TFI', 'FGS', 'NIRISS', 'ANY', 'N/A']

    Failed validating 'enum' in schema:
        OrderedDict([('title', 'Instrument used to acquire the data'),
                     ('type', 'string'),
                     ('enum',
                      ['NIRCAM',
                       'NIRSPEC',
                       'MIRI',
                       'TFI',
                       'FGS',
                       'NIRISS',
                       'ANY',
                       'N/A']),
                     ('fits_keyword', 'INSTRUME'),
                     ('blend_table', True)])

    On instance:
        'WFC3'
      warnings.warn(errmsg, ValidationWarning)
    /Users/jpierel/miniconda3/envs/jhat/lib/python3.8/site-packages/stdatamodels/validate.py:38: ValidationWarning: While validating meta.instrument.detector the following error occurred:
    'IR' is not one of ['NRCA1', 'NRCA2', 'NRCA3', 'NRCA4', 'NRCALONG', 'NRCB1', 'NRCB2', 'NRCB3', 'NRCB4', 'NRCBLONG', 'NRS1', 'NRS2', 'ANY', 'MIRIMAGE', 'MIRIFULONG', 'MIRIFUSHORT', 'NIS', 'GUIDER1', 'GUIDER2', 'N/A', 'MULTIPLE']

    Failed validating 'enum' in schema:
        OrderedDict([('title', 'Name of detector used to acquire the data'),
                     ('type', 'string'),
                     ('enum',
                      ['NRCA1',
                       'NRCA2',
                       'NRCA3',
                       'NRCA4',
                       'NRCALONG',
                       'NRCB1',
                       'NRCB2',
                       'NRCB3',
                       'NRCB4',
                       'NRCBLONG',
                       'NRS1',
                       'NRS2',
                       'ANY',
                       'MIRIMAGE',
                       'MIRIFULONG',
                       'MIRIFUSHORT',
                       'NIS',
                       'GUIDER1',
                       'GUIDER2',
                       'N/A',
                       'MULTIPLE']),
                     ('fits_keyword', 'DETECTOR'),
                     ('blend_table', True),
                     ('blend_rule', 'multi')])

    On instance:
        'IR'
      warnings.warn(errmsg, ValidationWarning)
    /Users/jpierel/miniconda3/envs/jhat/lib/python3.8/site-packages/stdatamodels/validate.py:38: ValidationWarning: While validating meta.subarray.name the following error occurred:
    False is not of type 'string'

    Failed validating 'type' in schema:
        OrderedDict([('title', 'Subarray used'),
                     ('type', 'string'),
                     ('anyOf',
                      [{'enum': ['8X8',
                                 '32X32',
                                 '128X128',
                                 '2048X64',
                                 'SUB128CNTR',
                                 'SUB128DIAG',
                                 'SUB128LL',
                                 'SUB32CNTR',
                                 'SUB32DIAG',
                                 'SUB32LL',
                                 'SUB8CNTR',
                                 'SUB8DIAG',
                                 'SUB8LL',
                                 'SUBIDSTRIPCENTER',
                                 'SUBIDSTRIPLL',
                                 'SUBTUNE32CENTERG1',
                                 'SUBTUNE32CENTERG2',
                                 'SUBTUNE32LLG1',
                                 'SUBTUNE32LLG2']},
                       {'enum': ['BRIGHTSKY',
                                 'MASK1065',
                                 'MASK1140',
                                 'MASK1550',
                                 'MASKLYOT',
                                 'SLITLESSPRISM',
                                 'SUB128',
                                 'SUB256',
                                 'SUB64',
                                 'SUBPRISM']},
                       {'enum': ['FULLP',
                                 'MASK210R',
                                 'MASK335R',
                                 'MASK430R',
                                 'MASKLWB',
                                 'MASKSWB',
                                 'SUB160',
                                 'SUB160P',
                                 'SUB320',
                                 'SUB320A335R',
                                 'SUB320A430R',
                                 'SUB320ALWB',
                                 'SUB320B335R',
                                 'SUB320B430R',
                      ...
      warnings.warn(errmsg, ValidationWarning)
    RA/Dec columns in reference catalog:  ra dec
    LOADING refcat mastDownload/HST/hst_16264_15_wfc3_ir_f110w_iebc15/hst_16264_15_wfc3_ir_f110w_iebc15_drz.phot.txt
    Matching reference catalog mastDownload/HST/hst_16264_15_wfc3_ir_f110w_iebc15/hst_16264_15_wfc3_ir_f110w_iebc15_drz.phot.txt
    image objects are in x_idl=[-67.59,118.37] and y_idl=[-61.98,106.29] range
    Keeping 769 out of 769 catalog objects within x=-40.0-1499 and y=-40.0-1498
    Keeping 769  after removing NaNs from ra/dec
    ########### !!!!!!!!!!  INITIAL CUT: starting with 947 objects
    d2d =0.5 CUT:
    67 left
    dmag_max =1.0 CUT:
    67 left
    SHARPNESS =(0.3, 0.9) CUT:
    65 left
    roundness1=(-0.7, 0.7) CUT:
    55 left
    objmag_lim=(14, 24) CUT:
    37 left
    # of matched objects that pass initial cuts: 37
    dx median: 0.15463329163537765
    dy median: -0.3430325224419448
    ### Doing histogram cut for dx, slope_min:-0.004883 slope_max:0.004883 slope_stepsize:0.000049
    Nfwhm=2.5, rough_cut_px_min=0.3, rough_cut_px_max=0.8, Nsigma=3.0
    ########################
    ### rotate dx versus y
    Applying rolling gaussian:
    gaussian_sigma_px=0.22, binsize=0.2, gaussian_sigma(bins)=1.0999999999999999, windowsize(bins)=7 halfwindowsize(bins)=4
    slope min: -0.0048828125, slope max: 0.0048828125, slope stepsize: slope_stepsize
    iteration 0 out of 200: slope = -0.004883
    iteration 1 out of 200: slope = -0.004834
    iteration 2 out of 200: slope = -0.004785
    iteration 3 out of 200: slope = -0.004736
    iteration 4 out of 200: slope = -0.004688
    iteration 5 out of 200: slope = -0.004639
    iteration 6 out of 200: slope = -0.004590
    iteration 7 out of 200: slope = -0.004541
    iteration 8 out of 200: slope = -0.004492
    iteration 9 out of 200: slope = -0.004443
    iteration 10 out of 200: slope = -0.004395
    iteration 11 out of 200: slope = -0.004346
    iteration 12 out of 200: slope = -0.004297
    iteration 13 out of 200: slope = -0.004248
    iteration 14 out of 200: slope = -0.004199
    iteration 15 out of 200: slope = -0.004150
    iteration 16 out of 200: slope = -0.004102
    iteration 17 out of 200: slope = -0.004053
    iteration 18 out of 200: slope = -0.004004
    iteration 19 out of 200: slope = -0.003955
    iteration 20 out of 200: slope = -0.003906
    iteration 21 out of 200: slope = -0.003857
    iteration 22 out of 200: slope = -0.003809
    iteration 23 out of 200: slope = -0.003760
    iteration 24 out of 200: slope = -0.003711
    iteration 25 out of 200: slope = -0.003662
    iteration 26 out of 200: slope = -0.003613
    iteration 27 out of 200: slope = -0.003564
    iteration 28 out of 200: slope = -0.003516
    iteration 29 out of 200: slope = -0.003467
    iteration 30 out of 200: slope = -0.003418
    iteration 31 out of 200: slope = -0.003369
    iteration 32 out of 200: slope = -0.003320
    iteration 33 out of 200: slope = -0.003271
    iteration 34 out of 200: slope = -0.003223
    iteration 35 out of 200: slope = -0.003174
    iteration 36 out of 200: slope = -0.003125
    iteration 37 out of 200: slope = -0.003076
    iteration 38 out of 200: slope = -0.003027
    iteration 39 out of 200: slope = -0.002979
    iteration 40 out of 200: slope = -0.002930
    iteration 41 out of 200: slope = -0.002881
    iteration 42 out of 200: slope = -0.002832
    iteration 43 out of 200: slope = -0.002783
    iteration 44 out of 200: slope = -0.002734
    iteration 45 out of 200: slope = -0.002686
    iteration 46 out of 200: slope = -0.002637
    iteration 47 out of 200: slope = -0.002588
    iteration 48 out of 200: slope = -0.002539
    iteration 49 out of 200: slope = -0.002490
    iteration 50 out of 200: slope = -0.002441
    iteration 51 out of 200: slope = -0.002393
    iteration 52 out of 200: slope = -0.002344
    iteration 53 out of 200: slope = -0.002295
    iteration 54 out of 200: slope = -0.002246
    iteration 55 out of 200: slope = -0.002197
    iteration 56 out of 200: slope = -0.002148
    iteration 57 out of 200: slope = -0.002100
    iteration 58 out of 200: slope = -0.002051
    iteration 59 out of 200: slope = -0.002002
    iteration 60 out of 200: slope = -0.001953
    iteration 61 out of 200: slope = -0.001904
    iteration 62 out of 200: slope = -0.001855
    iteration 63 out of 200: slope = -0.001807
    iteration 64 out of 200: slope = -0.001758
    iteration 65 out of 200: slope = -0.001709
    iteration 66 out of 200: slope = -0.001660
    iteration 67 out of 200: slope = -0.001611
    iteration 68 out of 200: slope = -0.001563
    iteration 69 out of 200: slope = -0.001514
    iteration 70 out of 200: slope = -0.001465
    iteration 71 out of 200: slope = -0.001416
    iteration 72 out of 200: slope = -0.001367
    iteration 73 out of 200: slope = -0.001318
    iteration 74 out of 200: slope = -0.001270
    iteration 75 out of 200: slope = -0.001221
    iteration 76 out of 200: slope = -0.001172
    iteration 77 out of 200: slope = -0.001123
    iteration 78 out of 200: slope = -0.001074
    iteration 79 out of 200: slope = -0.001025
    iteration 80 out of 200: slope = -0.000977
    iteration 81 out of 200: slope = -0.000928
    iteration 82 out of 200: slope = -0.000879
    iteration 83 out of 200: slope = -0.000830
    iteration 84 out of 200: slope = -0.000781
    iteration 85 out of 200: slope = -0.000732
    iteration 86 out of 200: slope = -0.000684
    iteration 87 out of 200: slope = -0.000635
    iteration 88 out of 200: slope = -0.000586
    iteration 89 out of 200: slope = -0.000537
    iteration 90 out of 200: slope = -0.000488
    iteration 91 out of 200: slope = -0.000439
    iteration 92 out of 200: slope = -0.000391
    iteration 93 out of 200: slope = -0.000342
    iteration 94 out of 200: slope = -0.000293
    iteration 95 out of 200: slope = -0.000244
    iteration 96 out of 200: slope = -0.000195
    iteration 97 out of 200: slope = -0.000146
    iteration 98 out of 200: slope = -0.000098
    iteration 99 out of 200: slope = -0.000049
    iteration 100 out of 200: slope = -0.000000
    iteration 101 out of 200: slope = 0.000049
    iteration 102 out of 200: slope = 0.000098
    iteration 103 out of 200: slope = 0.000146
    iteration 104 out of 200: slope = 0.000195
    iteration 105 out of 200: slope = 0.000244
    iteration 106 out of 200: slope = 0.000293
    iteration 107 out of 200: slope = 0.000342
    iteration 108 out of 200: slope = 0.000391
    iteration 109 out of 200: slope = 0.000439
    iteration 110 out of 200: slope = 0.000488
    iteration 111 out of 200: slope = 0.000537
    iteration 112 out of 200: slope = 0.000586
    iteration 113 out of 200: slope = 0.000635
    iteration 114 out of 200: slope = 0.000684
    iteration 115 out of 200: slope = 0.000732
    iteration 116 out of 200: slope = 0.000781
    iteration 117 out of 200: slope = 0.000830
    iteration 118 out of 200: slope = 0.000879
    iteration 119 out of 200: slope = 0.000928
    iteration 120 out of 200: slope = 0.000977
    iteration 121 out of 200: slope = 0.001025
    iteration 122 out of 200: slope = 0.001074
    iteration 123 out of 200: slope = 0.001123
    iteration 124 out of 200: slope = 0.001172
    iteration 125 out of 200: slope = 0.001221
    iteration 126 out of 200: slope = 0.001270
    iteration 127 out of 200: slope = 0.001318
    iteration 128 out of 200: slope = 0.001367
    iteration 129 out of 200: slope = 0.001416
    iteration 130 out of 200: slope = 0.001465
    iteration 131 out of 200: slope = 0.001514
    iteration 132 out of 200: slope = 0.001562
    iteration 133 out of 200: slope = 0.001611
    iteration 134 out of 200: slope = 0.001660
    iteration 135 out of 200: slope = 0.001709
    iteration 136 out of 200: slope = 0.001758
    iteration 137 out of 200: slope = 0.001807
    iteration 138 out of 200: slope = 0.001855
    iteration 139 out of 200: slope = 0.001904
    iteration 140 out of 200: slope = 0.001953
    iteration 141 out of 200: slope = 0.002002
    iteration 142 out of 200: slope = 0.002051
    iteration 143 out of 200: slope = 0.002100
    iteration 144 out of 200: slope = 0.002148
    iteration 145 out of 200: slope = 0.002197
    iteration 146 out of 200: slope = 0.002246
    iteration 147 out of 200: slope = 0.002295
    iteration 148 out of 200: slope = 0.002344
    iteration 149 out of 200: slope = 0.002393
    iteration 150 out of 200: slope = 0.002441
    iteration 151 out of 200: slope = 0.002490
    iteration 152 out of 200: slope = 0.002539
    iteration 153 out of 200: slope = 0.002588
    iteration 154 out of 200: slope = 0.002637
    iteration 155 out of 200: slope = 0.002686
    iteration 156 out of 200: slope = 0.002734
    iteration 157 out of 200: slope = 0.002783
    iteration 158 out of 200: slope = 0.002832
    iteration 159 out of 200: slope = 0.002881
    iteration 160 out of 200: slope = 0.002930
    iteration 161 out of 200: slope = 0.002979
    iteration 162 out of 200: slope = 0.003027
    iteration 163 out of 200: slope = 0.003076
    iteration 164 out of 200: slope = 0.003125
    iteration 165 out of 200: slope = 0.003174
    iteration 166 out of 200: slope = 0.003223
    iteration 167 out of 200: slope = 0.003271
    iteration 168 out of 200: slope = 0.003320
    iteration 169 out of 200: slope = 0.003369
    iteration 170 out of 200: slope = 0.003418
    iteration 171 out of 200: slope = 0.003467
    iteration 172 out of 200: slope = 0.003516
    iteration 173 out of 200: slope = 0.003564
    iteration 174 out of 200: slope = 0.003613
    iteration 175 out of 200: slope = 0.003662
    iteration 176 out of 200: slope = 0.003711
    iteration 177 out of 200: slope = 0.003760
    iteration 178 out of 200: slope = 0.003809
    iteration 179 out of 200: slope = 0.003857
    iteration 180 out of 200: slope = 0.003906
    iteration 181 out of 200: slope = 0.003955
    iteration 182 out of 200: slope = 0.004004
    iteration 183 out of 200: slope = 0.004053
    iteration 184 out of 200: slope = 0.004102
    iteration 185 out of 200: slope = 0.004150
    iteration 186 out of 200: slope = 0.004199
    iteration 187 out of 200: slope = 0.004248
    iteration 188 out of 200: slope = 0.004297
    iteration 189 out of 200: slope = 0.004346
    iteration 190 out of 200: slope = 0.004395
    iteration 191 out of 200: slope = 0.004443
    iteration 192 out of 200: slope = 0.004492
    iteration 193 out of 200: slope = 0.004541
    iteration 194 out of 200: slope = 0.004590
    iteration 195 out of 200: slope = 0.004639
    iteration 196 out of 200: slope = 0.004687
    iteration 197 out of 200: slope = 0.004736
    iteration 198 out of 200: slope = 0.004785
    iteration 199 out of 200: slope = 0.004834
            slope     intercept    maxval  index  d_bestguess  fwhm  multimax
    -4.882812e-03  3.559570e+00  6.367534     30     2.120327   1.0     False
    -4.833984e-03  3.523975e+00  6.029049     30     2.135896   1.2     False
    -4.785156e-03  3.488379e+00  6.499068     30     2.151464   0.8     False
    -4.736328e-03  3.452783e+00  6.969088     30     2.167033   0.8     False
    -4.687500e-03  3.417188e+00  7.307573     30     2.182601   0.8     False
    -4.638672e-03  3.381592e+00  6.969088     30     2.198170   0.8     False
    -4.589844e-03  3.345996e+00  6.969088     30     2.213738   0.8     False
    -4.541016e-03  3.310400e+00  6.969088     30     2.229307   0.8     False
    -4.492188e-03  3.274805e+00  6.837554     30     2.244875   1.0     False
    -4.443359e-03  3.239209e+00  6.837554     29     2.060444   1.0     False
    -4.394531e-03  3.203613e+00  7.176039     29     2.076013   0.8     False
    -4.345703e-03  3.168018e+00  7.176039     29     2.091581   0.8     False
    -4.296875e-03  3.132422e+00  6.499068     29     2.107150   0.8     False
    -4.248047e-03  3.096826e+00  6.969088     29     2.110693   0.8     False
    -4.199219e-03  3.061230e+00  7.307573     29     2.111311   0.8     False
    -4.150391e-03  3.025635e+00  7.307573     29     2.111928   0.8     False
    -4.101563e-03  2.990039e+00  6.837554     29     2.112545   0.8     False
    -4.052734e-03  2.954443e+00  7.176039     29     2.113162   0.8     False
    -4.003906e-03  2.918848e+00  7.176039     29     2.113780   0.8     False
    -3.955078e-03  2.883252e+00  7.176039     29     2.114397   0.8     False
    -3.906250e-03  2.847656e+00  6.837554     29     2.115014   0.8     False
    -3.857422e-03  2.812061e+00  6.837554     29     2.115631   0.8     False
    -3.808594e-03  2.776465e+00  6.837554     29     2.116248   0.8     False
    -3.759766e-03  2.740869e+00  6.367534     29     2.116866   1.0     False
    -3.710938e-03  2.705273e+00  6.367534     29     2.117483   1.0     False
    -3.662109e-03  2.669678e+00  6.367534     29     2.118100   1.0     False
    -3.613281e-03  2.634082e+00  6.367534     29     2.118717   1.0     False
    -3.564453e-03  2.598486e+00  6.029049     29     2.119335   1.0     False
    -3.515625e-03  2.562891e+00  5.901526     18    -0.080048   1.6     False
    -3.466797e-03  2.527295e+00  6.068763     18    -0.079431   1.6     False
    -3.417969e-03  2.491699e+00  6.068763     18    -0.078814   1.6     False
    -3.369141e-03  2.456104e+00  6.117279     18    -0.078196   2.0     False
    -3.320313e-03  2.420508e+00  6.117279     18    -0.077579   2.0     False
    -3.271484e-03  2.384912e+00  6.117279     18    -0.076962   2.0     False
    -3.222656e-03  2.349316e+00  5.778794     18    -0.076345   2.0     False
    -3.173828e-03  2.313721e+00  5.778794     18    -0.075727   2.0     False
    -3.125000e-03  2.278125e+00  5.778794     18    -0.075110   2.0     False
    -3.076172e-03  2.242529e+00  6.273071     18    -0.074493   1.6     False
    -3.027344e-03  2.206934e+00  6.273071     18    -0.073876   1.6     False
    -2.978516e-03  2.171338e+00  6.523326     19     0.126742   1.6     False
    -2.929688e-03  2.135742e+00  6.523326     19     0.127359   1.6     False
    -2.880859e-03  2.100146e+00  6.993346     19     0.127976   1.6     False
    -2.832031e-03  2.064551e+00  6.993346     19     0.128593   1.6     False
    -2.783203e-03  2.028955e+00  6.993346     19     0.129211   1.6     False
    -2.734375e-03  1.993359e+00  6.993346     19     0.129828   1.6     False
    -2.685547e-03  1.957764e+00  7.440308     18    -0.069555   1.4     False
    -2.636719e-03  1.922168e+00  7.440308     18    -0.068938   1.6     False
    -2.587891e-03  1.886572e+00  7.910328     18    -0.068320   1.0     False
    -2.539063e-03  1.850977e+00  7.910328     18    -0.067703   1.0     False
    -2.490234e-03  1.815381e+00  7.571843     18    -0.067086   1.6     False
    -2.441406e-03  1.779785e+00  7.739080     18    -0.066469   1.2     False
    -2.392578e-03  1.744189e+00  7.870614     18    -0.065852   1.4     False
    -2.343750e-03  1.708594e+00  7.870614     18    -0.065234   1.4     False
    -2.294922e-03  1.672998e+00  7.532128     18    -0.064617   1.4     False
    -2.246094e-03  1.637402e+00  7.699366     18    -0.064000   1.0     False
    -2.197266e-03  1.601807e+00  8.037851     18    -0.063383   1.0     False
    -2.148438e-03  1.566211e+00  8.037851     18    -0.062765   1.0     False
    -2.099609e-03  1.530615e+00  8.037851     18    -0.062148   1.2     False
    -2.050781e-03  1.495020e+00  8.037851     18    -0.061531   1.2     False
    -2.001953e-03  1.459424e+00  8.037851     18    -0.060914   1.2     False
    -1.953125e-03  1.423828e+00  8.037851     18    -0.060296   1.2     False
    -1.904297e-03  1.388232e+00  7.567832     18    -0.059679   1.4     False
    -1.855469e-03  1.352637e+00  7.906317     18    -0.059062   1.2     False
    -1.806641e-03  1.317041e+00  7.783585     17    -0.258445   1.4     False
    -1.757813e-03  1.281445e+00  8.122070     17    -0.257827   1.2     False
    -1.708984e-03  1.245850e+00  8.122070     17    -0.257210   1.2     False
    -1.660156e-03  1.210254e+00  8.507870     18    -0.056593   1.0     False
    -1.611328e-03  1.174658e+00  8.507870     18    -0.055976   1.0     False
    -1.562500e-03  1.139063e+00  8.507870     18    -0.055358   1.0     False
    -1.513672e-03  1.103467e+00  8.340633     18    -0.054741   1.2     False
    -1.464844e-03  1.067871e+00  7.870614     18    -0.054124   1.4     False
    -1.416016e-03  1.032275e+00  7.400594     18    -0.053507   1.4     False
    -1.367188e-03  9.966797e-01  7.652051     17    -0.252889   1.4     False
    -1.318359e-03  9.610840e-01  7.652051     17    -0.252272   1.4     False
    -1.269531e-03  9.254883e-01  8.146328     17    -0.251655   1.4     False
    -1.220703e-03  8.898926e-01  8.146328     17    -0.251038   1.4     False
    -1.171875e-03  8.542969e-01  8.146328     17    -0.250421   1.4     False
    -1.123047e-03  8.187012e-01  7.640606     17    -0.249803   1.4     False
    -1.074219e-03  7.831055e-01  7.640606     17    -0.249186   1.4     False
    -1.025391e-03  7.475098e-01  7.882059     18    -0.048569   1.4     False
    -9.765625e-04  7.119141e-01  7.714822     18    -0.047952   1.4     False
    -9.277344e-04  6.763184e-01  7.714822     18    -0.047334   1.4     False
    -8.789063e-04  6.407227e-01  7.269060     18    -0.046717   1.6     False
    -8.300781e-04  6.051270e-01  7.269060     18    -0.046100   1.6     False
    -7.812500e-04  5.695313e-01  7.269060     18    -0.045483   1.6     False
    -7.324219e-04  5.339355e-01  7.269060     18    -0.044865   1.6     False
    -6.835938e-04  4.983398e-01  7.607546     18    -0.044248   1.6     False
    -6.347656e-04  4.627441e-01  7.607546     18    -0.043631   1.6     False
    -5.859375e-04  4.271484e-01  7.607546     18    -0.043014   1.6     False
    -5.371094e-04  3.915527e-01  7.607546     18    -0.042396   1.8     False
    -4.882813e-04  3.559570e-01  7.607546     18    -0.041779   1.8     False
    -4.394531e-04  3.203613e-01  7.297329     19     0.155327   2.4     False
    -3.906250e-04  2.847656e-01  7.635815     19     0.139282   2.4     False
    -3.417969e-04  2.491699e-01  7.635815     19     0.123237   2.4     False
    -2.929688e-04  2.135742e-01  7.635815     19     0.107192   2.4     False
    -2.441406e-04  1.779785e-01  7.950042     19     0.091147   1.2     False
    -1.953125e-04  1.423828e-01  7.635815     19     0.075102   2.2     False
    -1.464844e-04  1.067871e-01  7.297329     19     0.059057   2.4     False
    -9.765625e-05  7.119141e-02  7.269060     20     0.243011   1.4     False
    -4.882813e-05  3.559570e-02  8.077565     20     0.226966   1.0     False
    -1.734723e-17  1.264613e-14  8.101823     20     0.210921   1.2     False
     4.882812e-05 -3.559570e-02  8.101823     20     0.194876   1.2     False
     9.765625e-05 -7.119141e-02  7.631804     20     0.178831   1.4     False
     1.464844e-04 -1.067871e-01  7.656062     20     0.162786   2.2     False
     1.953125e-04 -1.423828e-01  7.396583     21     0.346741   2.2     False
     2.441406e-04 -1.779785e-01  7.396583     21     0.330696   2.4     False
     2.929687e-04 -2.135742e-01  7.866603     21     0.314651   1.2     False
     3.417969e-04 -2.491699e-01  8.205088     21     0.298606   1.2     False
     3.906250e-04 -2.847656e-01  8.205088     21     0.282561   1.2     False
     4.394531e-04 -3.203613e-01  9.037851     21     0.266516   1.0     False
     4.882812e-04 -3.559570e-01  8.882059     22     0.450471   1.0     False
     5.371094e-04 -3.915527e-01  8.882059     22     0.434426   1.0     False
     5.859375e-04 -4.271484e-01  8.882059     22     0.418381   1.0     False
     6.347656e-04 -4.627441e-01  8.882059     22     0.402336   1.0     False
     6.835937e-04 -4.983398e-01  8.882059     22     0.386291   1.0     False
     7.324219e-04 -5.339355e-01  9.352078     22     0.370246   1.0     False
     7.812500e-04 -5.695312e-01  9.037851     22     0.354200   1.0     False
     8.300781e-04 -6.051270e-01  8.699366     22     0.338155   1.0     False
     8.789062e-04 -6.407227e-01  9.639405     22     0.322110   1.0     False
     9.277344e-04 -6.763184e-01  9.977890     22     0.306065   1.0     False
     9.765625e-04 -7.119141e-01 10.316375     22     0.290020   0.8     False
     1.025391e-03 -7.475098e-01 10.654861     22     0.273975   0.8     False
     1.074219e-03 -7.831055e-01 10.376336     22     0.257930   0.8     False
     1.123047e-03 -8.187012e-01  9.906317     22     0.241885   0.8     False
     1.171875e-03 -8.542969e-01  9.906317     22     0.225840   0.8     False
     1.220703e-03 -8.898926e-01  9.906317     22     0.209795   0.8     False
     1.269531e-03 -9.254883e-01  9.906317     22     0.193750   0.8     False
     1.318359e-03 -9.610840e-01 10.583288     22     0.177705   0.8     False
     1.367187e-03 -9.966797e-01 10.583288     22     0.161660   0.8     False
     1.416016e-03 -1.032275e+00 10.718833     22     0.145615   0.8     False
     1.464844e-03 -1.067871e+00 10.718833     22     0.129570   0.8     False
     1.513672e-03 -1.103467e+00 10.041862     22     0.113525   1.0     False
     1.562500e-03 -1.139062e+00  9.882059     23     0.297480   1.0     False
     1.611328e-03 -1.174658e+00  9.906317     23     0.281434   1.0     False
     1.660156e-03 -1.210254e+00  9.906317     23     0.265389   1.0     False
     1.708984e-03 -1.245850e+00 10.209099     23     0.249344   1.0     False
     1.757812e-03 -1.281445e+00 10.380347     23     0.233299   1.0     False
     1.806641e-03 -1.317041e+00 10.380347     23     0.217254   1.0     False
     1.855469e-03 -1.352637e+00 10.718833     23     0.201209   0.8     False
     1.904297e-03 -1.388232e+00 10.718833     23     0.185164   0.8     False
     1.953125e-03 -1.423828e+00 10.718833     23     0.169119   0.8     False
     2.001953e-03 -1.459424e+00 11.033060     23     0.153074   0.8     False
     2.050781e-03 -1.495020e+00 10.670317     23     0.137029   0.8     False
     2.099609e-03 -1.530615e+00 10.331831     23     0.120984   0.8     False
     2.148437e-03 -1.566211e+00 10.499068     23     0.104939   0.8     False
     2.197266e-03 -1.601807e+00 10.499068     23     0.088894   0.8     False
     2.246094e-03 -1.637402e+00 10.160583     23     0.072849   0.8     False
     2.294922e-03 -1.672998e+00 10.160583     23     0.056804   0.8     False
     2.343750e-03 -1.708594e+00  9.822098     23     0.040759   0.8     False
     2.392578e-03 -1.744189e+00  9.822098     23     0.024714   0.8     False
     2.441406e-03 -1.779785e+00  9.483612     23     0.008669   1.0     False
     2.490234e-03 -1.815381e+00  9.483612     23    -0.007377   1.0     False
     2.539062e-03 -1.850977e+00  9.391792     24     0.176578   1.0     False
     2.587891e-03 -1.886572e+00  9.391792     24     0.160533   1.0     False
     2.636719e-03 -1.922168e+00  8.376336     24     0.144488   1.6     False
     2.685547e-03 -1.957764e+00  8.205088     24     0.128443   1.4     False
     2.734375e-03 -1.993359e+00  8.205088     24     0.112398   1.4     False
     2.783203e-03 -2.028955e+00  8.205088     24     0.096353   1.4     False
     2.832031e-03 -2.064551e+00  8.205088     24     0.080308   1.4     False
     2.880859e-03 -2.100146e+00  8.229346     24     0.064263   1.4     False
     2.929687e-03 -2.135742e+00  8.229346     24     0.048218   1.4     False
     2.978516e-03 -2.171338e+00  7.440308     25     0.232173   1.6     False
     3.027344e-03 -2.206934e+00  7.445099     24     0.016128   1.6     False
     3.076172e-03 -2.242529e+00  7.778794     25     0.200083   1.6     False
     3.125000e-03 -2.278125e+00  7.440308     25     0.184038   1.6     False
     3.173828e-03 -2.313721e+00  6.592090     25     0.167993   1.8     False
     3.222656e-03 -2.349316e+00  6.592090     25     0.151948   1.8     False
     3.271484e-03 -2.384912e+00  6.739080     22    -0.464097   1.6     False
     3.320312e-03 -2.420508e+00  7.077565     22    -0.480143   1.6     False
     3.369141e-03 -2.456104e+00  7.547585     22    -0.496188   1.6     False
     3.417969e-03 -2.491699e+00  7.547585     22    -0.512233   1.6     False
     3.466797e-03 -2.527295e+00  7.547585     22    -0.528278   1.6     False
     3.515625e-03 -2.562891e+00  7.547585     22    -0.544323   1.6     False
     3.564453e-03 -2.598486e+00  7.523326     22    -0.560368   1.6     False
     3.613281e-03 -2.634082e+00  7.317576     23    -0.376413   1.6     False
     3.662109e-03 -2.669678e+00  7.488824     23    -0.392458   1.6     False
     3.710937e-03 -2.705273e+00  7.101823     23    -0.408503   1.8     False
     3.759766e-03 -2.740869e+00  7.547585     23    -0.424548   1.8     False
     3.808594e-03 -2.776465e+00  7.547585     23    -0.440593   1.8     False
     3.857422e-03 -2.812061e+00  7.547585     23    -0.456638   1.8     False
     3.906250e-03 -2.847656e+00  8.017604     23    -0.472683   1.6     False
     3.955078e-03 -2.883252e+00  7.209099     23    -0.488728   1.6     False
     4.003906e-03 -2.918848e+00  6.870614     23    -0.504773   1.6     False
     4.052734e-03 -2.954443e+00  6.870614     23    -0.520818   1.6     False
     4.101562e-03 -2.990039e+00  6.846356     23    -0.536863   1.6     False
     4.150391e-03 -3.025635e+00  6.846356     23    -0.552908   1.6     False
     4.199219e-03 -3.061230e+00  6.822098     23    -0.568954   1.8     False
     4.248047e-03 -3.096826e+00  5.882059     23    -0.584999   2.2     False
     4.296875e-03 -3.132422e+00  6.220544     23    -0.601044   2.0     False
     4.345703e-03 -3.168018e+00  6.220544     23    -0.617089   2.0     False
     4.394531e-03 -3.203613e+00  5.827310     28     0.366866   2.0     False
     4.443359e-03 -3.239209e+00  5.827310     28     0.350821   2.0     False
     4.492187e-03 -3.274805e+00  6.089010     23    -0.665224   2.0     False
     4.541016e-03 -3.310400e+00  5.921773     23    -0.681269   2.0     False
     4.589844e-03 -3.345996e+00  5.921773     23    -0.697314   2.0     False
     4.638672e-03 -3.381592e+00  5.921773     23    -0.713359   2.0     False
     4.687500e-03 -3.417187e+00  5.921773     23    -0.729404   2.2     False
     4.736328e-03 -3.452783e+00  5.994547     28     0.254551   2.0     False
     4.785156e-03 -3.488379e+00  6.101823     29     0.438506   2.2     False
     4.833984e-03 -3.523975e+00  6.101823     29     0.422461   2.2     False
    ####BEST:
       slope  intercept   maxval  index  d_bestguess  fwhm  multimax
    0.002002  -1.459424 11.03306     23     0.153074   0.8     False
    Setting rough_cut_px=2.0000000000000018. limits: (0.3-0.8)
    Setting rough_cut_px=0.8

    ####################
    ### d_rotated cut (Nsigma=3.0)
    Keeping 15 out of 15, skippin 0 because of null values in columns d_rot_tmp
    median: 0.150623
    75.000000 percentile cut: max residual for cut: 0.181393
    median: 0.150623
    i:00 mean:0.150623(0.028641) stdev:0.090570(0.019310) X2norm:0.95 Nchanged:0 Ngood:11 Nclip:4

    mean: 0.121218
    i:01 mean:0.121218(0.029338) stdev:0.097303(0.019862) X2norm:1.00 Nchanged:1 Ngood:12 Nclip:3

    mean: 0.121218
    i:02 mean:0.121218(0.029338) stdev:0.097303(0.019862) X2norm:1.00 Nchanged:0 Ngood:12 Nclip:3
    i:02 mean:0.121218(0.029338) stdev:0.097303(0.019862) X2norm:1.00 Nchanged:0 Ngood:12 Nclip:3
    ### Doing histogram cut for dy, slope_min:-0.004883 slope_max:0.004883 slope_stepsize:0.000049
    Nfwhm=2.5, rough_cut_px_min=0.3, rough_cut_px_max=0.8, Nsigma=3.0
    ########################
    ### rotate dy versus x
    Applying rolling gaussian:
    gaussian_sigma_px=0.22, binsize=0.2, gaussian_sigma(bins)=1.0999999999999999, windowsize(bins)=7 halfwindowsize(bins)=4
    slope min: -0.0048828125, slope max: 0.0048828125, slope stepsize: slope_stepsize
    iteration 0 out of 200: slope = -0.004883
    iteration 1 out of 200: slope = -0.004834
    iteration 2 out of 200: slope = -0.004785
    iteration 3 out of 200: slope = -0.004736
    iteration 4 out of 200: slope = -0.004688
    iteration 5 out of 200: slope = -0.004639
    iteration 6 out of 200: slope = -0.004590
    iteration 7 out of 200: slope = -0.004541
    iteration 8 out of 200: slope = -0.004492
    iteration 9 out of 200: slope = -0.004443
    iteration 10 out of 200: slope = -0.004395
    iteration 11 out of 200: slope = -0.004346
    iteration 12 out of 200: slope = -0.004297
    iteration 13 out of 200: slope = -0.004248
    iteration 14 out of 200: slope = -0.004199
    iteration 15 out of 200: slope = -0.004150
    iteration 16 out of 200: slope = -0.004102
    iteration 17 out of 200: slope = -0.004053
    iteration 18 out of 200: slope = -0.004004
    iteration 19 out of 200: slope = -0.003955
    iteration 20 out of 200: slope = -0.003906
    iteration 21 out of 200: slope = -0.003857
    iteration 22 out of 200: slope = -0.003809
    iteration 23 out of 200: slope = -0.003760
    iteration 24 out of 200: slope = -0.003711
    iteration 25 out of 200: slope = -0.003662
    iteration 26 out of 200: slope = -0.003613
    iteration 27 out of 200: slope = -0.003564
    iteration 28 out of 200: slope = -0.003516
    iteration 29 out of 200: slope = -0.003467
    iteration 30 out of 200: slope = -0.003418
    iteration 31 out of 200: slope = -0.003369
    iteration 32 out of 200: slope = -0.003320
    iteration 33 out of 200: slope = -0.003271
    iteration 34 out of 200: slope = -0.003223
    iteration 35 out of 200: slope = -0.003174
    iteration 36 out of 200: slope = -0.003125
    iteration 37 out of 200: slope = -0.003076
    iteration 38 out of 200: slope = -0.003027
    iteration 39 out of 200: slope = -0.002979
    iteration 40 out of 200: slope = -0.002930
    iteration 41 out of 200: slope = -0.002881
    iteration 42 out of 200: slope = -0.002832
    iteration 43 out of 200: slope = -0.002783
    iteration 44 out of 200: slope = -0.002734
    iteration 45 out of 200: slope = -0.002686
    iteration 46 out of 200: slope = -0.002637
    iteration 47 out of 200: slope = -0.002588
    iteration 48 out of 200: slope = -0.002539
    iteration 49 out of 200: slope = -0.002490
    iteration 50 out of 200: slope = -0.002441
    iteration 51 out of 200: slope = -0.002393
    iteration 52 out of 200: slope = -0.002344
    iteration 53 out of 200: slope = -0.002295
    iteration 54 out of 200: slope = -0.002246
    iteration 55 out of 200: slope = -0.002197
    iteration 56 out of 200: slope = -0.002148
    iteration 57 out of 200: slope = -0.002100
    iteration 58 out of 200: slope = -0.002051
    iteration 59 out of 200: slope = -0.002002
    iteration 60 out of 200: slope = -0.001953
    iteration 61 out of 200: slope = -0.001904
    iteration 62 out of 200: slope = -0.001855
    iteration 63 out of 200: slope = -0.001807
    iteration 64 out of 200: slope = -0.001758
    iteration 65 out of 200: slope = -0.001709
    iteration 66 out of 200: slope = -0.001660
    iteration 67 out of 200: slope = -0.001611
    iteration 68 out of 200: slope = -0.001563
    iteration 69 out of 200: slope = -0.001514
    iteration 70 out of 200: slope = -0.001465
    iteration 71 out of 200: slope = -0.001416
    iteration 72 out of 200: slope = -0.001367
    iteration 73 out of 200: slope = -0.001318
    iteration 74 out of 200: slope = -0.001270
    iteration 75 out of 200: slope = -0.001221
    iteration 76 out of 200: slope = -0.001172
    iteration 77 out of 200: slope = -0.001123
    iteration 78 out of 200: slope = -0.001074
    iteration 79 out of 200: slope = -0.001025
    iteration 80 out of 200: slope = -0.000977
    iteration 81 out of 200: slope = -0.000928
    iteration 82 out of 200: slope = -0.000879
    iteration 83 out of 200: slope = -0.000830
    iteration 84 out of 200: slope = -0.000781
    iteration 85 out of 200: slope = -0.000732
    iteration 86 out of 200: slope = -0.000684
    iteration 87 out of 200: slope = -0.000635
    iteration 88 out of 200: slope = -0.000586
    iteration 89 out of 200: slope = -0.000537
    iteration 90 out of 200: slope = -0.000488
    iteration 91 out of 200: slope = -0.000439
    iteration 92 out of 200: slope = -0.000391
    iteration 93 out of 200: slope = -0.000342
    iteration 94 out of 200: slope = -0.000293
    iteration 95 out of 200: slope = -0.000244
    iteration 96 out of 200: slope = -0.000195
    iteration 97 out of 200: slope = -0.000146
    iteration 98 out of 200: slope = -0.000098
    iteration 99 out of 200: slope = -0.000049
    iteration 100 out of 200: slope = -0.000000
    iteration 101 out of 200: slope = 0.000049
    iteration 102 out of 200: slope = 0.000098
    iteration 103 out of 200: slope = 0.000146
    iteration 104 out of 200: slope = 0.000195
    iteration 105 out of 200: slope = 0.000244
    iteration 106 out of 200: slope = 0.000293
    iteration 107 out of 200: slope = 0.000342
    iteration 108 out of 200: slope = 0.000391
    iteration 109 out of 200: slope = 0.000439
    iteration 110 out of 200: slope = 0.000488
    iteration 111 out of 200: slope = 0.000537
    iteration 112 out of 200: slope = 0.000586
    iteration 113 out of 200: slope = 0.000635
    iteration 114 out of 200: slope = 0.000684
    iteration 115 out of 200: slope = 0.000732
    iteration 116 out of 200: slope = 0.000781
    iteration 117 out of 200: slope = 0.000830
    iteration 118 out of 200: slope = 0.000879
    iteration 119 out of 200: slope = 0.000928
    iteration 120 out of 200: slope = 0.000977
    iteration 121 out of 200: slope = 0.001025
    iteration 122 out of 200: slope = 0.001074
    iteration 123 out of 200: slope = 0.001123
    iteration 124 out of 200: slope = 0.001172
    iteration 125 out of 200: slope = 0.001221
    iteration 126 out of 200: slope = 0.001270
    iteration 127 out of 200: slope = 0.001318
    iteration 128 out of 200: slope = 0.001367
    iteration 129 out of 200: slope = 0.001416
    iteration 130 out of 200: slope = 0.001465
    iteration 131 out of 200: slope = 0.001514
    iteration 132 out of 200: slope = 0.001562
    iteration 133 out of 200: slope = 0.001611
    iteration 134 out of 200: slope = 0.001660
    iteration 135 out of 200: slope = 0.001709
    iteration 136 out of 200: slope = 0.001758
    iteration 137 out of 200: slope = 0.001807
    iteration 138 out of 200: slope = 0.001855
    iteration 139 out of 200: slope = 0.001904
    iteration 140 out of 200: slope = 0.001953
    iteration 141 out of 200: slope = 0.002002
    iteration 142 out of 200: slope = 0.002051
    iteration 143 out of 200: slope = 0.002100
    iteration 144 out of 200: slope = 0.002148
    iteration 145 out of 200: slope = 0.002197
    iteration 146 out of 200: slope = 0.002246
    iteration 147 out of 200: slope = 0.002295
    iteration 148 out of 200: slope = 0.002344
    iteration 149 out of 200: slope = 0.002393
    iteration 150 out of 200: slope = 0.002441
    iteration 151 out of 200: slope = 0.002490
    iteration 152 out of 200: slope = 0.002539
    iteration 153 out of 200: slope = 0.002588
    iteration 154 out of 200: slope = 0.002637
    iteration 155 out of 200: slope = 0.002686
    iteration 156 out of 200: slope = 0.002734
    iteration 157 out of 200: slope = 0.002783
    iteration 158 out of 200: slope = 0.002832
    iteration 159 out of 200: slope = 0.002881
    iteration 160 out of 200: slope = 0.002930
    iteration 161 out of 200: slope = 0.002979
    iteration 162 out of 200: slope = 0.003027
    iteration 163 out of 200: slope = 0.003076
    iteration 164 out of 200: slope = 0.003125
    iteration 165 out of 200: slope = 0.003174
    iteration 166 out of 200: slope = 0.003223
    iteration 167 out of 200: slope = 0.003271
    iteration 168 out of 200: slope = 0.003320
    iteration 169 out of 200: slope = 0.003369
    iteration 170 out of 200: slope = 0.003418
    iteration 171 out of 200: slope = 0.003467
    iteration 172 out of 200: slope = 0.003516
    iteration 173 out of 200: slope = 0.003564
    iteration 174 out of 200: slope = 0.003613
    iteration 175 out of 200: slope = 0.003662
    iteration 176 out of 200: slope = 0.003711
    iteration 177 out of 200: slope = 0.003760
    iteration 178 out of 200: slope = 0.003809
    iteration 179 out of 200: slope = 0.003857
    iteration 180 out of 200: slope = 0.003906
    iteration 181 out of 200: slope = 0.003955
    iteration 182 out of 200: slope = 0.004004
    iteration 183 out of 200: slope = 0.004053
    iteration 184 out of 200: slope = 0.004102
    iteration 185 out of 200: slope = 0.004150
    iteration 186 out of 200: slope = 0.004199
    iteration 187 out of 200: slope = 0.004248
    iteration 188 out of 200: slope = 0.004297
    iteration 189 out of 200: slope = 0.004346
    iteration 190 out of 200: slope = 0.004395
    iteration 191 out of 200: slope = 0.004443
    iteration 192 out of 200: slope = 0.004492
    iteration 193 out of 200: slope = 0.004541
    iteration 194 out of 200: slope = 0.004590
    iteration 195 out of 200: slope = 0.004639
    iteration 196 out of 200: slope = 0.004687
    iteration 197 out of 200: slope = 0.004736
    iteration 198 out of 200: slope = 0.004785
    iteration 199 out of 200: slope = 0.004834
            slope     intercept   maxval  index  d_bestguess  fwhm  multimax
    -4.882812e-03  3.562012e+00 3.694575     34     1.966974   1.2     False
    -4.833984e-03  3.526392e+00 3.260258     35     2.181469   1.4     False
    -4.785156e-03  3.490771e+00 3.563041     34     1.995963   1.4     False
    -4.736328e-03  3.455151e+00 3.730278     34     2.010457   1.4     False
    -4.687500e-03  3.419531e+00 3.730278     34     2.024952   1.4     False
    -4.638672e-03  3.383911e+00 3.598744     34     2.039446   1.2     False
    -4.589844e-03  3.348291e+00 3.598744     34     2.053941   1.2     False
    -4.541016e-03  3.312671e+00 3.431506     34     2.068435   1.6     False
    -4.492188e-03  3.277051e+00 3.431506     34     2.082930   1.6     False
    -4.443359e-03  3.241431e+00 3.431506     34     2.097424   1.6     False
    -4.394531e-03  3.205811e+00 3.538783     33     1.911918   1.4     False
    -4.345703e-03  3.170190e+00 3.538783     33     1.926413   1.4     False
    -4.296875e-03  3.134570e+00 3.538783     33     1.940907   1.4     False
    -4.248047e-03  3.098950e+00 3.538783     33     1.955402   1.0     False
    -4.199219e-03  3.063330e+00 3.224555     33     1.969896   1.4     False
    -4.150391e-03  3.027710e+00 3.224555     33     1.984391   1.4     False
    -4.101563e-03  2.992090e+00 2.754536     33     1.998885   1.6     False
    -4.052734e-03  2.956470e+00 2.754536     33     2.013380   1.6     False
    -4.003906e-03  2.920850e+00 2.730278     33     2.027874   1.6      True
    -3.955078e-03  2.885229e+00 2.563041     34     2.242368   1.8     False
    -3.906250e-03  2.849609e+00 2.563041     34     2.256863   1.8     False
    -3.857422e-03  2.813989e+00 2.694575     32     1.871357   1.8     False
    -3.808594e-03  2.778369e+00 3.068763     33     2.085852   1.4     False
    -3.759766e-03  2.742749e+00 3.068763     33     2.100346   1.4     False
    -3.710938e-03  2.707129e+00 2.901526     33     2.114841   1.6     False
    -3.662109e-03  2.671509e+00 2.901526     33     2.129335   1.6     False
    -3.613281e-03  2.635889e+00 2.901526     33     2.143829   1.6     False
    -3.564453e-03  2.600269e+00 2.901526     33     2.158324   1.6     False
    -3.515625e-03  2.564648e+00 2.734289     33     2.172818   2.0     False
    -3.466797e-03  2.529028e+00 2.710031     33     2.187313   1.0     False
    -3.417969e-03  2.493408e+00 2.710031     33     2.201807   1.0     False
    -3.369141e-03  2.457788e+00 2.710031     33     2.216302   1.0     False
    -3.320313e-03  2.422168e+00 2.710031     33     2.230796   1.8     False
    -3.271484e-03  2.386548e+00 2.710031     33     2.245290   1.8     False
    -3.222656e-03  2.350928e+00 2.710031     33     2.259785   2.0     False
    -3.173828e-03  2.315308e+00 2.710031     33     2.274279   2.2     False
    -3.125000e-03  2.279688e+00 2.877268     33     2.288774   1.0     False
    -3.076172e-03  2.244067e+00 2.877268     33     2.303268   1.0     False
    -3.027344e-03  2.208447e+00 2.877268     33     2.317763   1.0     False
    -2.978516e-03  2.172827e+00 2.853010     33     2.332257   0.8     False
    -2.929688e-03  2.137207e+00 2.853010     33     2.346752   0.8     False
    -2.880859e-03  2.101587e+00 2.710031     32     2.161246   1.0     False
    -2.832031e-03  2.065967e+00 3.048516     32     2.175740   0.8     False
    -2.783203e-03  2.030347e+00 3.048516     32     2.190235   0.8     False
    -2.734375e-03  1.994727e+00 3.048516     32     2.204729   0.8     False
    -2.685547e-03  1.959106e+00 3.048516     32     2.219224   0.8     False
    -2.636719e-03  1.923486e+00 3.048516     32     2.233718   0.8     False
    -2.587891e-03  1.887866e+00 3.048516     32     2.248213   0.8     False
    -2.539063e-03  1.852246e+00 3.048516     32     2.262707   0.8     False
    -2.490234e-03  1.816626e+00 3.048516     32     2.277201   0.8     False
    -2.441406e-03  1.781006e+00 3.048516     32     2.291696   0.8     False
    -2.392578e-03  1.745386e+00 3.024258     32     2.306190   0.8     False
    -2.343750e-03  1.709766e+00 2.685773     32     2.320685   0.8     False
    -2.294922e-03  1.674146e+00 2.685773     32     2.335179   0.8     False
    -2.246094e-03  1.638525e+00 2.685773     31     2.149674   0.8     False
    -2.197266e-03  1.602905e+00 2.685773     31     2.164168   0.8     False
    -2.148438e-03  1.567285e+00 2.685773     31     2.178663   0.8     False
    -2.099609e-03  1.531665e+00 2.685773     31     2.193157   0.8     False
    -2.050781e-03  1.496045e+00 2.710031     31     2.207651   1.0     False
    -2.001953e-03  1.460425e+00 2.710031     31     2.222146   1.0     False
    -1.953125e-03  1.424805e+00 3.048516     31     2.236640   0.8     False
    -1.904297e-03  1.389185e+00 3.048516     31     2.251135   0.8     False
    -1.855469e-03  1.353564e+00 2.685773     31     2.265629   0.8     False
    -1.806641e-03  1.317944e+00 2.685773     31     2.280124   0.8     False
    -1.757813e-03  1.282324e+00 2.685773     31     2.294618   0.8     False
    -1.708984e-03  1.246704e+00 2.685773     31     2.309112   0.8     False
    -1.660156e-03  1.211084e+00 2.685773     31     2.323607   0.8     False
    -1.611328e-03  1.175464e+00 2.685773     31     2.338101   0.8     False
    -1.562500e-03  1.139844e+00 2.685773     31     2.352596   0.8     False
    -1.513672e-03  1.104224e+00 2.685773     31     2.367090   0.8     False
    -1.464844e-03  1.068604e+00 2.685773     31     2.381585   0.8     False
    -1.416016e-03  1.032983e+00 2.685773     31     2.396079   0.8     False
    -1.367188e-03  9.973633e-01 2.984544     19     0.010574   1.0     False
    -1.318359e-03  9.617432e-01 2.984544     19     0.025068   1.0     False
    -1.269531e-03  9.261230e-01 2.984544     19     0.039562   1.0     False
    -1.220703e-03  8.905029e-01 3.323029     19     0.054057   0.8     False
    -1.171875e-03  8.548828e-01 3.323029     19     0.068551   0.8     False
    -1.123047e-03  8.192627e-01 3.661515     19     0.083046   0.8     False
    -1.074219e-03  7.836426e-01 2.984544     18    -0.102460   1.0     False
    -1.025391e-03  7.480225e-01 2.984544     18    -0.087965   1.0     False
    -9.765625e-04  7.124023e-01 2.984544     18    -0.073471   1.0     False
    -9.277344e-04  6.767822e-01 3.661515     18    -0.058977   0.8     False
    -8.789063e-04  6.411621e-01 3.661515     18    -0.044482   0.8     False
    -8.300781e-04  6.055420e-01 3.661515     18    -0.029988   0.8     False
    -7.812500e-04  5.699219e-01 3.661515     18    -0.015493   0.8     False
    -7.324219e-04  5.343018e-01 3.661515     18    -0.000999   0.8     False
    -6.835938e-04  4.986816e-01 3.661515     17    -0.186504   0.8     False
    -6.347656e-04  4.630615e-01 3.661515     17    -0.172010   0.8     False
    -5.859375e-04  4.274414e-01 3.323029     17    -0.157516   0.8     False
    -5.371094e-04  3.918213e-01 3.323029     17    -0.143021   0.8     False
    -4.882813e-04  3.562012e-01 3.323029     17    -0.128527   0.8     False
    -4.394531e-04  3.205811e-01 2.984544     17    -0.114032   1.0     False
    -3.906250e-04  2.849609e-01 3.191495     16    -0.299538   0.8     False
    -3.417969e-04  2.493408e-01 3.661515     16    -0.285043   0.8     False
    -2.929688e-04  2.137207e-01 3.661515     16    -0.270549   0.8     False
    -2.441406e-04  1.781006e-01 3.661515     16    -0.256054   0.8     False
    -1.953125e-04  1.424805e-01 3.323029     16    -0.241560   0.8     False
    -1.464844e-04  1.068604e-01 3.323029     16    -0.227066   0.8     False
    -9.765625e-05  7.124023e-02 3.191495     15    -0.412571   0.8     False
    -4.882813e-05  3.562012e-02 3.191495     15    -0.398077   0.8     False
    -1.734723e-17  1.265481e-14 3.191495     15    -0.383582   0.8     False
     4.882812e-05 -3.562012e-02 2.853010     15    -0.369088   0.8     False
     9.765625e-05 -7.124023e-02 2.853010     15    -0.354593   0.8     False
     1.464844e-04 -1.068604e-01 2.853010     15    -0.366132   0.8     False
     1.953125e-04 -1.424805e-01 2.853010     15    -0.393321   0.8     False
     2.441406e-04 -1.781006e-01 2.853010     15    -0.420509   0.8     False
     2.929687e-04 -2.137207e-01 2.853010     15    -0.447697   0.8     False
     3.417969e-04 -2.493408e-01 2.853010     15    -0.474886   0.8     False
     3.906250e-04 -2.849609e-01 2.347287     15    -0.502074   1.2     False
     4.394531e-04 -3.205811e-01 2.347287     15    -0.529263   1.2     False
     4.882812e-04 -3.562012e-01 2.347287     15    -0.556451   1.2     False
     5.371094e-04 -3.918213e-01 2.347287     15    -0.583639   1.2     False
     5.859375e-04 -4.274414e-01 2.347287     15    -0.610828   1.2     False
     6.347656e-04 -4.630615e-01 2.347287     15    -0.638016   1.2     False
     6.835937e-04 -4.986816e-01 2.347287     15    -0.665204   1.2     False
     7.324219e-04 -5.343018e-01 2.323029     15    -0.692393   0.8     False
     7.812500e-04 -5.699219e-01 2.323029     15    -0.719581   0.8     False
     8.300781e-04 -6.055420e-01 2.323029     15    -0.746769   0.8     False
     8.789062e-04 -6.411621e-01 2.024258     32     2.626042   1.2     False
     9.277344e-04 -6.767822e-01 2.024258     32     2.598854   1.2     False
     9.765625e-04 -7.124023e-01 2.024258     32     2.571665   1.2     False
     1.025391e-03 -7.480225e-01 2.000000     32     2.544477   0.8     False
     1.074219e-03 -7.836426e-01 2.000000     32     2.517289   0.8     False
     1.123047e-03 -8.192627e-01 2.024258     33     2.690100   1.2     False
     1.171875e-03 -8.548828e-01 2.024258     33     2.662912   1.2     False
     1.220703e-03 -8.905029e-01 2.024258     33     2.635724   1.2     False
     1.269531e-03 -9.261230e-01 2.024258     33     2.608535   1.2     False
     1.318359e-03 -9.617432e-01 2.000000     33     2.581347   0.8     False
     1.367187e-03 -9.973633e-01 2.000000     33     2.554159   0.8     False
     1.416016e-03 -1.032983e+00 2.024258     34     2.726970   1.2     False
     1.464844e-03 -1.068604e+00 2.024258     34     2.699782   1.2     False
     1.513672e-03 -1.104224e+00 2.024258     34     2.672593   1.2     False
     1.562500e-03 -1.139844e+00 2.323029     28     1.445405   0.8     False
     1.611328e-03 -1.175464e+00 2.000000     34     2.618217   0.8     False
     1.660156e-03 -1.211084e+00 2.000000     34     2.591028   0.8     False
     1.708984e-03 -1.246704e+00 1.853010     28     1.363840   1.0     False
     1.757812e-03 -1.282324e+00 2.024258     35     2.736652   1.2     False
     1.806641e-03 -1.317944e+00 2.024258     35     2.709463   1.2     False
     1.855469e-03 -1.353564e+00 2.191495     28     1.282275   1.0     False
     1.904297e-03 -1.389185e+00 2.191495     28     1.255087   1.0     False
     1.953125e-03 -1.424805e+00 2.323029     29     1.427898   0.8     False
     2.001953e-03 -1.460425e+00 2.323029     29     1.400710   0.8     False
     2.050781e-03 -1.496045e+00 2.024258     36     2.773521   1.2     False
     2.099609e-03 -1.531665e+00 2.024258     36     2.746333   1.2     False
     2.148437e-03 -1.567285e+00 2.191495     29     1.319145   1.0     False
     2.197266e-03 -1.602905e+00 2.191495     29     1.291956   1.0     False
     2.246094e-03 -1.638525e+00 2.191495     29     1.264768   1.0     False
     2.294922e-03 -1.674146e+00 2.191495     29     1.237580   1.0     False
     2.343750e-03 -1.709766e+00 2.191495     29     1.210391   1.0     False
     2.392578e-03 -1.745386e+00 2.323029     30     1.383203   0.8     False
     2.441406e-03 -1.781006e+00 2.323029     30     1.356015   0.8     False
     2.490234e-03 -1.816626e+00 2.191495     14    -1.871174   1.0      True
     2.539062e-03 -1.852246e+00 2.191495     14    -1.898362   1.0      True
     2.587891e-03 -1.887866e+00 2.191495     14    -1.925551   1.0      True
     2.636719e-03 -1.923486e+00 2.191495     14    -1.952739   1.0      True
     2.685547e-03 -1.959106e+00 2.191495     14    -1.979927   1.0      True
     2.734375e-03 -1.994727e+00 2.323029     15    -1.807116   0.8     False
     2.783203e-03 -2.030347e+00 2.661515     31     1.365696   0.8     False
     2.832031e-03 -2.065967e+00 2.661515     31     1.338508   0.8     False
     2.880859e-03 -2.101587e+00 2.661515     31     1.311319   0.8     False
     2.929687e-03 -2.137207e+00 2.661515     31     1.284131   0.8     False
     2.978516e-03 -2.172827e+00 2.191495     16    -1.743057   1.0      True
     3.027344e-03 -2.208447e+00 2.191495     16    -1.770246   1.0      True
     3.076172e-03 -2.244067e+00 2.323029     32     1.402566   0.8     False
     3.125000e-03 -2.279687e+00 2.323029     32     1.375378   0.8     False
     3.173828e-03 -2.315308e+00 2.661515     32     1.348189   0.8     False
     3.222656e-03 -2.350928e+00 2.661515     32     1.321001   0.8     False
     3.271484e-03 -2.386548e+00 2.661515     32     1.293812   0.8     False
     3.320312e-03 -2.422168e+00 2.661515     32     1.266624   0.8     False
     3.369141e-03 -2.457788e+00 2.661515     32     1.239436   0.8     False
     3.417969e-03 -2.493408e+00 2.323029     33     1.412247   0.8     False
     3.466797e-03 -2.529028e+00 2.323029     33     1.385059   0.8     False
     3.515625e-03 -2.564648e+00 2.323029     33     1.357871   0.8     False
     3.564453e-03 -2.600269e+00 2.661515     33     1.330682   0.8     False
     3.613281e-03 -2.635889e+00 2.661515     33     1.303494   0.8     False
     3.662109e-03 -2.671509e+00 2.661515     33     1.276306   0.8     False
     3.710937e-03 -2.707129e+00 2.661515     34     1.449117   0.8     False
     3.759766e-03 -2.742749e+00 2.661515     34     1.421929   0.8     False
     3.808594e-03 -2.778369e+00 2.661515     34     1.394740   0.8     False
     3.857422e-03 -2.813989e+00 2.323029     34     1.367552   0.8     False
     3.906250e-03 -2.849609e+00 2.323029     34     1.340364   0.8     False
     3.955078e-03 -2.885229e+00 2.323029     34     1.313175   0.8     False
     4.003906e-03 -2.920850e+00 2.661515     35     1.485987   0.8     False
     4.052734e-03 -2.956470e+00 2.661515     35     1.458799   0.8     False
     4.101562e-03 -2.992090e+00 2.661515     35     1.431610   0.8     False
     4.150391e-03 -3.027710e+00 2.661515     35     1.404422   0.8     False
     4.199219e-03 -3.063330e+00 2.661515     35     1.377234   0.8     False
     4.248047e-03 -3.098950e+00 2.661515     35     1.350045   0.8     False
     4.296875e-03 -3.134570e+00 2.661515     35     1.322857   0.8     False
     4.345703e-03 -3.170190e+00 2.191495     36     1.495668   1.0     False
     4.394531e-03 -3.205811e+00 2.661515     36     1.468480   0.8     False
     4.443359e-03 -3.241431e+00 2.661515     36     1.441292   0.8     False
     4.492187e-03 -3.277051e+00 2.661515     36     1.414103   0.8     False
     4.541016e-03 -3.312671e+00 2.661515     36     1.386915   0.8     False
     4.589844e-03 -3.348291e+00 2.661515     36     1.359727   0.8     False
     4.638672e-03 -3.383911e+00 2.323029     36     1.332538   0.8     False
     4.687500e-03 -3.419531e+00 2.323029     36     1.305350   0.8     False
     4.736328e-03 -3.455151e+00 2.323029     36     1.278162   0.8     False
     4.785156e-03 -3.490771e+00 2.661515     37     1.450973   0.8     False
     4.833984e-03 -3.526392e+00 2.661515     37     1.423785   0.8     False
    ####BEST:
        slope  intercept   maxval  index  d_bestguess  fwhm  multimax
    -0.004736   3.455151 3.730278     34     2.010457   1.4     False
    Setting rough_cut_px=3.500000000000003. limits: (0.3-0.8)
    Setting rough_cut_px=0.8

    ####################
    ### d_rotated cut (Nsigma=3.0)
    Keeping 7 out of 7, skippin 0 because of null values in columns d_rot_tmp
    median: 2.091404
    75.000000 percentile cut: max residual for cut: 0.431718
    median: 2.091404
    i:00 mean:2.091404(0.148013) stdev:0.296026(0.093612) X2norm:0.88 Nchanged:0 Ngood:5 Nclip:2

    mean: 2.098362
    i:01 mean:2.098362(0.147229) stdev:0.360636(0.096384) X2norm:1.00 Nchanged:2 Ngood:7 Nclip:0

    mean: 2.098362
    i:02 mean:2.098362(0.147229) stdev:0.360636(0.096384) X2norm:1.00 Nchanged:0 Ngood:7 Nclip:0
    i:02 mean:2.098362(0.147229) stdev:0.360636(0.096384) X2norm:1.00 Nchanged:0 Ngood:7 Nclip:0
    /Users/jpierel/miniconda3/envs/jhat/lib/python3.8/site-packages/stdatamodels/validate.py:38: ValidationWarning: While validating meta.instrument.name the following error occurred:
    'WFC3' is not one of ['NIRCAM', 'NIRSPEC', 'MIRI', 'TFI', 'FGS', 'NIRISS', 'ANY', 'N/A']

    Failed validating 'enum' in schema:
        OrderedDict([('title', 'Instrument used to acquire the data'),
                     ('type', 'string'),
                     ('enum',
                      ['NIRCAM',
                       'NIRSPEC',
                       'MIRI',
                       'TFI',
                       'FGS',
                       'NIRISS',
                       'ANY',
                       'N/A']),
                     ('fits_keyword', 'INSTRUME'),
                     ('blend_table', True)])

    On instance:
        'WFC3'
      warnings.warn(errmsg, ValidationWarning)
    /Users/jpierel/miniconda3/envs/jhat/lib/python3.8/site-packages/stdatamodels/validate.py:38: ValidationWarning: While validating meta.instrument.detector the following error occurred:
    'IR' is not one of ['NRCA1', 'NRCA2', 'NRCA3', 'NRCA4', 'NRCALONG', 'NRCB1', 'NRCB2', 'NRCB3', 'NRCB4', 'NRCBLONG', 'NRS1', 'NRS2', 'ANY', 'MIRIMAGE', 'MIRIFULONG', 'MIRIFUSHORT', 'NIS', 'GUIDER1', 'GUIDER2', 'N/A', 'MULTIPLE']

    Failed validating 'enum' in schema:
        OrderedDict([('title', 'Name of detector used to acquire the data'),
                     ('type', 'string'),
                     ('enum',
                      ['NRCA1',
                       'NRCA2',
                       'NRCA3',
                       'NRCA4',
                       'NRCALONG',
                       'NRCB1',
                       'NRCB2',
                       'NRCB3',
                       'NRCB4',
                       'NRCBLONG',
                       'NRS1',
                       'NRS2',
                       'ANY',
                       'MIRIMAGE',
                       'MIRIFULONG',
                       'MIRIFUSHORT',
                       'NIS',
                       'GUIDER1',
                       'GUIDER2',
                       'N/A',
                       'MULTIPLE']),
                     ('fits_keyword', 'DETECTOR'),
                     ('blend_table', True),
                     ('blend_rule', 'multi')])

    On instance:
        'IR'
      warnings.warn(errmsg, ValidationWarning)
    /Users/jpierel/miniconda3/envs/jhat/lib/python3.8/site-packages/stdatamodels/validate.py:38: ValidationWarning: While validating meta.subarray.name the following error occurred:
    False is not of type 'string'

    Failed validating 'type' in schema:
        OrderedDict([('title', 'Subarray used'),
                     ('type', 'string'),
                     ('anyOf',
                      [{'enum': ['8X8',
                                 '32X32',
                                 '128X128',
                                 '2048X64',
                                 'SUB128CNTR',
                                 'SUB128DIAG',
                                 'SUB128LL',
                                 'SUB32CNTR',
                                 'SUB32DIAG',
                                 'SUB32LL',
                                 'SUB8CNTR',
                                 'SUB8DIAG',
                                 'SUB8LL',
                                 'SUBIDSTRIPCENTER',
                                 'SUBIDSTRIPLL',
                                 'SUBTUNE32CENTERG1',
                                 'SUBTUNE32CENTERG2',
                                 'SUBTUNE32LLG1',
                                 'SUBTUNE32LLG2']},
                       {'enum': ['BRIGHTSKY',
                                 'MASK1065',
                                 'MASK1140',
                                 'MASK1550',
                                 'MASKLYOT',
                                 'SLITLESSPRISM',
                                 'SUB128',
                                 'SUB256',
                                 'SUB64',
                                 'SUBPRISM']},
                       {'enum': ['FULLP',
                                 'MASK210R',
                                 'MASK335R',
                                 'MASK430R',
                                 'MASKLWB',
                                 'MASKSWB',
                                 'SUB160',
                                 'SUB160P',
                                 'SUB320',
                                 'SUB320A335R',
                                 'SUB320A430R',
                                 'SUB320ALWB',
                                 'SUB320B335R',
                                 'SUB320B430R',
                      ...
      warnings.warn(errmsg, ValidationWarning)
    /Users/jpierel/miniconda3/envs/jhat/lib/python3.8/site-packages/jwst/datamodels/util.py:234: NoTypeWarning: model_type not found. Opening mastDownload/HST/hst_16264_12_wfc3_ir_f110w_iebc12/hst_16264_12_wfc3_ir_f110w_iebc12_drz.fits as a ImageModel
      warnings.warn(f"model_type not found. Opening {file_name} as a {class_name}",
    mastDownload/hst_16264_12_wfc3_ir_f110w_iebc12_tweakregstep.fits
    Setting output directory for tweakregstep.fits file to mastDownload

    0



.. GENERATED FROM PYTHON SOURCE LINES 146-151

**Check the Output**

The reference image has not changed, but let's read in the newly
aligned image and compare with the original. 
subsequent correction needed for optimal alignment.

.. GENERATED FROM PYTHON SOURCE LINES 151-173

.. code-block:: default


    aligned_image = os.path.join('mastDownload',os.path.basename(align_image).replace('drz.fits','tweakregstep.fits'))
    aligned_fits = fits.open(aligned_image)
    aligned_data = fits.open(aligned_image)['SCI',1].data
    aligned_y,aligned_x = skycoord_to_pixel(star_location,wcs.WCS(aligned_fits['SCI',1],aligned_fits))
    aligned_cutout = extract_array(aligned_data,(11,11),(aligned_x,aligned_y))

    norm3 = simple_norm(aligned_cutout,stretch='log',min_cut=-1,max_cut=200)
    fig,axes = plt.subplots(1,3)
    axes[0].imshow(ref_cutout, origin='lower',
                          norm=norm1,cmap='gray')
    axes[1].imshow(align_cutout, origin='lower',
                          norm=norm2,cmap='gray')
    axes[2].imshow(aligned_cutout, origin='lower',
                          norm=norm3,cmap='gray')
    axes[0].set_title('Reference')
    axes[1].set_title('To Align')
    axes[2].set_title('Aligned')
    for i in range(3):
    	axes[i].tick_params(labelcolor='none',axis='both',color='none')


    plt.show()


.. image-sg:: /examples/images/sphx_glr_plot_a_hst_006.png
   :alt: Reference, To Align, Aligned
   :srcset: /examples/images/sphx_glr_plot_a_hst_006.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  11.110 seconds)


.. _sphx_glr_download_examples_plot_a_hst.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example


    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_a_hst.py <plot_a_hst.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_a_hst.ipynb <plot_a_hst.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
